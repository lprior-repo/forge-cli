terraform {
  required_version = ">= 1.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = ">= 5.0"
    }
  }
}

provider "aws" {
  # Region will be set via AWS_REGION environment variable or AWS config
}

# Use terraform-aws-modules/lambda/aws module for best practices
module "lambda_function" {
  source  = "terraform-aws-modules/lambda/aws"
  version = "~> 7.0"

  function_name = "{{ .Name }}"
  description   = "{{ .Description }}"
  handler       = "handler.lambda_handler"
  runtime       = "{{ .Runtime }}"
  timeout       = 30
  memory_size   = 256

  # Build configuration - Forge handles the build
  create_package         = false
  local_existing_package = "lambda.zip"

  # IAM role configuration
  create_role = true
  role_name   = "{{ .Name }}-lambda-role"

  attach_cloudwatch_logs_policy = true
  cloudwatch_logs_retention_in_days = 7

  # Architecture
  architectures = ["x86_64"]

  # Tags
  tags = {
    Name        = "{{ .Name }}"
    ManagedBy   = "Forge"
    Runtime     = "python"
  }
}

output "function_name" {
  description = "The name of the Lambda function"
  value       = module.lambda_function.lambda_function_name
}

output "function_arn" {
  description = "The ARN of the Lambda function"
  value       = module.lambda_function.lambda_function_arn
}

output "function_invoke_arn" {
  description = "The Invoke ARN of the Lambda function"
  value       = module.lambda_function.lambda_function_invoke_arn
}

output "function_role_arn" {
  description = "The ARN of the IAM role created for the Lambda function"
  value       = module.lambda_function.lambda_role_arn
}
